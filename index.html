<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D NFT Universe - Random Vertical Gallery</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c2e, #1a1a3e);
            color: white;
            overflow: hidden;
            height: 100vh;
        }
        
        #container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        header {
            background: rgba(10, 10, 40, 0.8);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(100, 100, 255, 0.3);
            pointer-events: auto;
        }
        
        h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        #wallet-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        #walletStatus {
            font-size: 0.9rem;
            color: #a0a0ff;
        }
        
        button {
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 117, 252, 0.4);
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            font-size: 1rem;
            backdrop-filter: blur(5px);
            border-top: 1px solid rgba(100, 100, 255, 0.3);
        }
        
        #location-info {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(100, 100, 255, 0.3);
        }
        
        #nft-counter {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(100, 100, 255, 0.3);
        }
        
        #nft-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 50, 0.95);
            border-radius: 15px;
            padding: 25px;
            z-index: 1000;
            width: 350px;
            max-width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 100, 255, 0.3);
            backdrop-filter: blur(10px);
            pointer-events: auto;
        }
        
        #nft-modal img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid rgba(100, 100, 255, 0.5);
        }
        
        #nft-modal h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
            color: #6a11cb;
        }
        
        #nft-modal p {
            margin-bottom: 8px;
            color: #c0c0ff;
            font-size: 0.9rem;
        }
        
        .nft-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .nft-actions button {
            flex: 1;
            padding: 10px;
        }
        
        #close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 50, 50, 0.8);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        #mini-map {
            position: absolute;
            bottom: 100px;
            right: 20px;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            border: 2px solid rgba(100, 100, 255, 0.5);
            overflow: hidden;
        }
        
        .floating-nft {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #6a11cb;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #6a11cb;
        }
        
        .floating-player {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px #00ff88;
        }
        
        #mobile-controls {
            display: none;
            position: absolute;
            bottom: 100px;
            left: 20px;
            z-index: 100;
            gap: 10px;
            flex-direction: column;
        }
        
        .mobile-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(100, 100, 255, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            pointer-events: auto;
            touch-action: manipulation;
            user-select: none;
        }
        
        @media (max-width: 768px) {
            #mobile-controls {
                display: flex;
            }
            
            #instructions {
                font-size: 0.8rem;
                padding: 10px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container"></div>
        
        <div id="ui-overlay">
            <header>
                <h1>NFT Universe Explorer</h1>
                <div id="wallet-section">
                    <div id="walletStatus">Not connected</div>
                    <button id="connectBtn">Connect Wallet</button>
                </div>
            </header>
            
            <div id="location-info">
                Location: Ground Level
            </div>
            
            <div id="nft-counter">
                NFTs Discovered: <span id="nft-count">0</span>/50
            </div>
            
            <div id="mini-map">
                <!-- Mini-map will be populated by JavaScript -->
            </div>
            
            <div id="mobile-controls">
                <div class="mobile-btn" id="up-btn">↑</div>
                <div style="display: flex; gap: 10px;">
                    <div class="mobile-btn" id="left-btn">←</div>
                    <div class="mobile-btn" id="down-btn">↓</div>
                    <div class="mobile-btn" id="right-btn">→</div>
                </div>
            </div>
            
            <div id="instructions">
                Click to lock pointer and navigate with WASD keys. Move mouse to look around. 
                Find and interact with NFTs floating in the random vertical column!
            </div>
        </div>
        
        <div id="nft-modal">
            <button id="close-modal">X</button>
            <img id="modal-image" src="" alt="NFT">
            <div class="nft-info">
                <h3 id="modal-title">NFT Name</h3>
                <p id="modal-description">NFT description will appear here.</p>
                <p><strong>Price:</strong> <span id="modal-price">0.1</span> ETH</p>
                <div class="nft-actions">
                    <button id="buy-btn">Buy NFT</button>
                    <button id="view-btn">View Details</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Scene setup
        let scene, camera, renderer, controls;
        let nftObjects = [];
        let player;
        let moveForward = false;
        let moveBackward = false;
        let moveLeft = false;
        let moveRight = false;
        let moveUp = false;
        let moveDown = false;
        let velocity = new THREE.Vector3();
        let canJump = true;
        let prevTime = performance.now();
        let raycaster, mouse;
        let currentIntersected = null;
        let nftCount = 0;
        
        // NFT data (in a real app, this would come from a database or API)
        const nftData = [
            { id: 1, name: "Cosmic Dragon", description: "A mythical dragon from the depths of space.", price: "0.5", image: "https://picsum.photos/400/400?random=1" },
            { id: 2, name: "Digital Dream", description: "A surreal landscape from the digital realm.", price: "0.3", image: "https://picsum.photos/400/400?random=2" },
            { id: 3, name: "Neon Samurai", description: "A warrior from the neon-lit future.", price: "0.7", image: "https://picsum.photos/400/400?random=3" },
            { id: 4, name: "Ethereal Spirit", description: "A mystical being of pure energy.", price: "0.4", image: "https://picsum.photos/400/400?random=4" },
            { id: 5, name: "Crypto Punk", description: "A rare artifact from the early blockchain days.", price: "1.2", image: "https://picsum.photos/400/400?random=5" },
            { id: 6, name: "Quantum Cat", description: "A feline existing in multiple states at once.", price: "0.8", image: "https://picsum.photos/400/400?random=6" },
            { id: 7, name: "Galactic Explorer", description: "An intrepid traveler of the cosmos.", price: "0.6", image: "https://picsum.photos/400/400?random=7" },
            { id: 8, name: "Digital Phoenix", description: "A mythical bird reborn in the digital age.", price: "0.9", image: "https://picsum.photos/400/400?random=8" },
            { id: 9, name: "Cyber Warrior", description: "A soldier enhanced with advanced technology.", price: "0.5", image: "https://picsum.photos/400/400?random=9" },
            { id: 10, name: "Mystic Orb", description: "A sphere containing ancient knowledge.", price: "0.3", image: "https://picsum.photos/400/400?random=10" }
        ];
        
        // Initialize the scene
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050520);
            scene.fog = new THREE.Fog(0x050520, 50, 500);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Add point lights for atmosphere
            const pointLight1 = new THREE.PointLight(0x4d79ff, 0.5, 200);
            pointLight1.position.set(30, 50, 30);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0xff4da6, 0.5, 200);
            pointLight2.position.set(-30, 80, -30);
            scene.add(pointLight2);
            
            // Create ground
            const groundGeometry = new THREE.PlaneGeometry(500, 500, 50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x1a1a3e,
                wireframe: false
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Create player (simple cube for demo)
            const playerGeometry = new THREE.BoxGeometry(2, 4, 2);
            const playerMaterial = new THREE.MeshLambertMaterial({ color: 0x00ff88 });
            player = new THREE.Mesh(playerGeometry, playerMaterial);
            player.position.set(0, 2, 0);
            player.castShadow = true;
            scene.add(player);
            
            // Create random vertical NFT column
            createRandomNFTColumn();
            
            // Set up controls
            controls = new THREE.PointerLockControls(camera, document.body);
            
            document.addEventListener('click', function() {
                if (!controls.isLocked) {
                    controls.lock();
                }
            });
            
            controls.addEventListener('lock', function() {
                document.getElementById('instructions').style.display = 'none';
            });
            
            controls.addEventListener('unlock', function() {
                document.getElementById('instructions').style.display = 'block';
            });
            
            // Set up keyboard controls
            const onKeyDown = function(event) {
                switch (event.code) {
                    case 'ArrowUp':
                    case 'KeyW':
                        moveForward = true;
                        break;
                    case 'ArrowLeft':
                    case 'KeyA':
                        moveLeft = true;
                        break;
                    case 'ArrowDown':
                    case 'KeyS':
                        moveBackward = true;
                        break;
                    case 'ArrowRight':
                    case 'KeyD':
                        moveRight = true;
                        break;
                    case 'Space':
                        if (canJump) {
                            velocity.y += 15;
                            canJump = false;
                        }
                        break;
                }
            };
            
            const onKeyUp = function(event) {
                switch (event.code) {
                    case 'ArrowUp':
                    case 'KeyW':
                        moveForward = false;
                        break;
                    case 'ArrowLeft':
                    case 'KeyA':
                        moveLeft = false;
                        break;
                    case 'ArrowDown':
                    case 'KeyS':
                        moveBackward = false;
                        break;
                    case 'ArrowRight':
                    case 'KeyD':
                        moveRight = false;
                        break;
                }
            };
            
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            
            // Set up mobile controls
            document.getElementById('up-btn').addEventListener('touchstart', () => moveForward = true);
            document.getElementById('up-btn').addEventListener('touchend', () => moveForward = false);
            
            document.getElementById('down-btn').addEventListener('touchstart', () => moveBackward = true);
            document.getElementById('down-btn').addEventListener('touchend', () => moveBackward = false);
            
            document.getElementById('left-btn').addEventListener('touchstart', () => moveLeft = true);
            document.getElementById('left-btn').addEventListener('touchend', () => moveLeft = false);
            
            document.getElementById('right-btn').addEventListener('touchstart', () => moveRight = true);
            document.getElementById('right-btn').addEventListener('touchend', () => moveRight = false);
            
            // Set up raycaster for NFT interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize);
            
            // Initialize mini-map
            initMiniMap();
            
            // Start animation
            animate();
        }
        
        // Create a random vertical column of NFTs
        function createRandomNFTColumn() {
            const columnHeight = 200;
            const baseX = 0;
            const baseZ = 0;
            
            // Create 50 NFTs at random positions within the column
            for (let i = 0; i < 50; i++) {
                // Random position within a cylindrical volume
                const height = Math.random() * columnHeight;
                const radius = Math.random() * 30; // Random distance from center
                const angle = Math.random() * Math.PI * 2; // Random angle
                
                const x = baseX + Math.cos(angle) * radius;
                const y = height + 5; // Start above ground
                const z = baseZ + Math.sin(angle) * radius;
                
                // Randomly select NFT data
                const nftInfo = nftData[Math.floor(Math.random() * nftData.length)];
                
                createNFT(x, y, z, nftInfo);
            }
        }
        
        // Create an NFT at the specified position
        function createNFT(x, y, z, nftInfo) {
            // Create platform for NFT
            const platformGeometry = new THREE.CylinderGeometry(3, 3, 0.5, 16);
            const platformMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2a2a5a,
                transparent: true,
                opacity: 0.8
            });
            const platform = new THREE.Mesh(platformGeometry, platformMaterial);
            platform.position.set(x, y - 2.5, z);
            platform.receiveShadow = true;
            scene.add(platform);
            
            // Create NFT display (a simple plane with texture)
            const nftGeometry = new THREE.PlaneGeometry(5, 5);
            const textureLoader = new THREE.TextureLoader();
            const nftMaterial = new THREE.MeshLambertMaterial({
                color: 0xffffff,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.9
            });
            
            const nftPlane = new THREE.Mesh(nftGeometry, nftMaterial);
            nftPlane.position.set(x, y, z);
            nftPlane.rotation.y = Math.PI / 4; // Angle the plane for better visibility
            
            // Load texture
            textureLoader.load(nftInfo.image, function(texture) {
                nftMaterial.map = texture;
                nftMaterial.needsUpdate = true;
            });
            
            nftPlane.castShadow = true;
            nftPlane.receiveShadow = true;
            
            // Store NFT data for interaction
            nftPlane.userData = {
                nftData: nftInfo,
                isNFT: true,
                originalEmissive: 0x000000
            };
            
            scene.add(nftPlane);
            nftObjects.push(nftPlane);
            
            // Add a glowing effect
            const glowGeometry = new THREE.SphereGeometry(0.5, 16, 16);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0x6a11cb,
                transparent: true,
                opacity: 0.7
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            glow.position.set(x, y - 1, z);
            scene.add(glow);
            
            // Add to mini-map
            addNFTToMiniMap(x, z);
        }
        
        // Initialize mini-map
        function initMiniMap() {
            const miniMap = document.getElementById('mini-map');
            
            // Add player indicator
            const playerIndicator = document.createElement('div');
            playerIndicator.className = 'floating-player';
            playerIndicator.style.left = '50%';
            playerIndicator.style.top = '50%';
            miniMap.appendChild(playerIndicator);
        }
        
        // Add NFT to mini-map
        function addNFTToMiniMap(x, z) {
            const miniMap = document.getElementById('mini-map');
            const nftIndicator = document.createElement('div');
            nftIndicator.className = 'floating-nft';
            
            // Convert world coordinates to mini-map coordinates
            const mapX = 50 + (x / 500) * 100;
            const mapY = 50 + (z / 500) * 100;
            
            nftIndicator.style.left = `${mapX}%`;
            nftIndicator.style.top = `${mapY}%`;
            
            miniMap.appendChild(nftIndicator);
        }
        
        // Update mini-map
        function updateMiniMap() {
            const playerIndicator = document.querySelector('.floating-player');
            if (playerIndicator) {
                // Convert player position to mini-map coordinates
                const mapX = 50 + (player.position.x / 500) * 100;
                const mapY = 50 + (player.position.z / 500) * 100;
                
                playerIndicator.style.left = `${mapX}%`;
                playerIndicator.style.top = `${mapY}%`;
            }
        }
        
        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Open NFT modal
        function openNFTModal(nftData) {
            document.getElementById('modal-image').src = nftData.image;
            document.getElementById('modal-title').textContent = nftData.name;
            document.getElementById('modal-description').textContent = nftData.description;
            document.getElementById('modal-price').textContent = nftData.price;
            document.getElementById('nft-modal').style.display = 'block';
            
            // Increment NFT count if this is the first time viewing
            if (!nftData.viewed) {
                nftData.viewed = true;
                nftCount++;
                document.getElementById('nft-count').textContent = nftCount;
            }
        }
        
        // Close NFT modal
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('nft-modal').style.display = 'none';
        });
        
        // Buy NFT button
        document.getElementById('buy-btn').addEventListener('click', function() {
            alert('NFT purchase functionality would be implemented here!');
        });
        
        // View details button
        document.getElementById('view-btn').addEventListener('click', function() {
            alert('NFT details would be shown here!');
        });
        
        // Connect wallet button
        document.getElementById('connectBtn').addEventListener('click', function() {
            document.getElementById('walletStatus').textContent = 'Connected: 0x7a3...f4c2';
            document.getElementById('connectBtn').textContent = 'Connected';
            document.getElementById('connectBtn').disabled = true;
        });
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            const time = performance.now();
            const delta = (time - prevTime) / 1000;
            
            // Update player movement
            if (controls.isLocked) {
                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;
                velocity.y -= 9.8 * 10.0 * delta; // gravity
                
                const direction = new THREE.Vector3();
                camera.getWorldDirection(direction);
                
                if (moveForward) velocity.z -= 400.0 * delta;
                if (moveBackward) velocity.z += 400.0 * delta;
                if (moveLeft) velocity.x -= 400.0 * delta;
                if (moveRight) velocity.x += 400.0 * delta;
                
                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);
                
                // Update player position for collision detection
                player.position.copy(controls.getObject().position);
                player.position.y -= 2; // Adjust for player height
                
                // Ground collision
                if (player.position.y < 2) {
                    player.position.y = 2;
                    velocity.y = 0;
                    canJump = true;
                }
                
                // Update location info based on height
                const height = player.position.y;
                let locationText = "Location: ";
                if (height < 10) locationText += "Ground Level";
                else if (height < 50) locationText += "Lower Heights";
                else if (height < 100) locationText += "Mid Heights";
                else if (height < 150) locationText += "Upper Heights";
                else locationText += "Sky Realm";
                
                document.getElementById('location-info').textContent = locationText;
            }
            
            prevTime = time;
            
            // Update raycaster for NFT interaction
            raycaster.setFromCamera(mouse, camera);
            
            const intersects = raycaster.intersectObjects(nftObjects);
            
            if (intersects.length > 0) {
                if (currentIntersected !== intersects[0].object) {
                    if (currentIntersected) {
                        currentIntersected.material.emissive.setHex(currentIntersected.userData.originalEmissive);
                    }
                    
                    currentIntersected = intersects[0].object;
                    currentIntersected.userData.originalEmissive = currentIntersected.material.emissive.getHex();
                    currentIntersected.material.emissive.setHex(0x6a11cb);
                    
                    document.body.style.cursor = 'pointer';
                }
            } else {
                if (currentIntersected) {
                    currentIntersected.material.emissive.setHex(currentIntersected.userData.originalEmissive);
                    currentIntersected = null;
                    document.body.style.cursor = 'auto';
                }
            }
            
            // Update mini-map
            updateMiniMap();
            
            // Render the scene
            renderer.render(scene, camera);
        }
        
        // Handle clicks on NFTs
        document.addEventListener('click', function(event) {
            if (currentIntersected && currentIntersected.userData.isNFT) {
                openNFTModal(currentIntersected.userData.nftData);
            }
        });
        
        // Mouse movement for raycaster
        document.addEventListener('mousemove', function(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        });
        
        // Initialize the application
        init();
    </script>
</body>
</html>
