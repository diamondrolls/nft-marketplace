<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíé NFT Marketplace</title>

  <!-- Supabase & Ethers -->
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.min.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 0;
    }
    header {
      background: white;
      text-align: center;
      padding: 16px;
      position: sticky;
      top: 0;
      border-bottom: 1px solid #ddd;
      z-index: 10;
    }
    h1 {
      font-size: 1.6rem;
      margin: 0;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      background: #0070f3;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.2s;
    }
    button:hover { background: #005bb5; }
    #wallet-address {
      font-size: 0.9rem;
      color: #0070f3;
      word-break: break-all;
      margin-top: 8px;
    }

    main {
      padding: 20px;
    }
    h2 {
      text-align: center;
      font-size: 1.4rem;
    }

    .nft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .nft-card {
      position: relative;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }
    .nft-card:hover {
      transform: scale(1.02);
    }
    .nft-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
    }
    .nft-info {
      padding: 12px;
      text-align: center;
    }
    .nft-info h3 {
      font-size: 20px;
      margin: 8px 0 0;
    }
    .nft-info p {
      margin: 4px 0;
    }

    .button-panel {
      max-height: 0;
      overflow: hidden;
      background: #f0f0f0;
      transition: max-height 0.3s ease-in-out;
      text-align: center;
      padding: 0;
    }
    .nft-card.active .button-panel {
      max-height: 150px;
      padding: 10px;
    }
    .button-panel button {
      display: block;
      width: 100%;
      margin: 6px 0;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>üíé NFT Marketplace</h1>
    <button onclick="connectWallet()">üîó Connect Wallet</button>
    <div id="wallet-address"></div>
  </header>

  <main>
    <h2>Explore NFTs</h2>
    <div class="nft-grid" id="nft-grid">
      <p style="text-align:center;">Loading NFTs...</p>
    </div>
  </main>

  <script>
    // ---------- Supabase Setup ----------
    const supabaseUrl = "https://fjtzodjudyctqacunlqp.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqdHpvZGp1ZHljdHFhY3VubHFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwNjA2OTQsImV4cCI6MjA3MzYzNjY5NH0.qR9RBsecfGUfKnbWgscmxloM-oEClJs_bo5YWoxFoE4";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    // ---------- MetaMask / Blockchain ----------
    let provider, signer, userAddress;
    const FEE_WALLET = "0xaE0C180e071eE288B2F2f6ff6edaeF014678fFB7"; // Your $6 fee wallet

    async function connectWallet() {
      if (!window.ethereum) return alert("Please install MetaMask!");
      provider = new ethers.BrowserProvider(window.ethereum);
      signer = await provider.getSigner();
      userAddress = (await signer.getAddress()).toLowerCase();
      document.getElementById("wallet-address").innerText = "Connected: " + userAddress;
      loadNFTs();
    }

    // ---------- Load NFTs from Supabase ----------
    async function loadNFTs() {
      const { data: nfts, error } = await supabaseClient
        .from("nfts")
        .select("id, description, collection, image_url, price_usd, owner_wallet, is_for_sale, token_id, price")
        .order("created_at", { ascending: false });

      if (error) {
        console.error("Supabase error:", error);
        document.getElementById("nft-grid").innerHTML = "<p style='color:red;'>Error loading NFTs.</p>";
        return;
      }

      renderNFTs(nfts);
    }

    // ---------- Render NFT Cards ----------
    function renderNFTs(nfts) {
      const grid = document.getElementById("nft-grid");
      grid.innerHTML = "";

      if (!nfts || nfts.length === 0) {
        grid.innerHTML = "<p style='text-align:center;'>No NFTs found.</p>";
        return;
      }

      nfts.forEach(nft => {
        const priceLabel = nft.price ? `${nft.price} ETH` : nft.price_usd ? `$${nft.price_usd}` : "N/A";
        const saleStatus = nft.is_for_sale ? "For Sale ‚úÖ" : "Not for Sale ‚ùå";

        const card = document.createElement("div");
        card.className = "nft-card";
        card.innerHTML = `
          <img src="${nft.image_url}" alt="${nft.collection}" />
          <div class="nft-info">
            <h3>${nft.collection || "Unnamed Collection"}</h3>
            <p>${nft.description || ""}</p>
            <p><strong>${priceLabel}</strong></p>
            <p style="color:gray;font-size:0.9rem;">${saleStatus}</p>
          </div>
          <div class="button-panel">
            ${
              nft.is_for_sale
                ? `<button onclick="buyNFT('${nft.id}', ${nft.token_id}, '${nft.price}')">üõí Buy (${priceLabel})</button>`
                : `<button disabled style="opacity:0.5;">Not for Sale</button>`
            }
            <button onclick="promptTransfer(${nft.token_id})">üîÑ Transfer</button>
          </div>
        `;
        card.onclick = () => {
          document.querySelectorAll(".nft-card").forEach(c => c.classList.remove("active"));
          card.classList.toggle("active");
        };
        grid.appendChild(card);
      });
    }

    // ---------- Buy NFT Placeholder ----------
    async function buyNFT(uuid, tokenId, price) {
      alert(`Buy logic goes here:\nUUID: ${uuid}\nToken ID: ${tokenId}\nPrice: ${price || "N/A"}\nFee: $6 to ${FEE_WALLET}`);
      // Future: Ethereum smart contract + $6 fee integration
    }

    // ---------- Transfer NFT Placeholder ----------
    function promptTransfer(tokenId) {
      const newAddress = prompt("Enter wallet address to transfer NFT #" + tokenId + ":");
      if (!newAddress) return;
      alert(`Transfer logic will go here for token #${tokenId} ‚Üí ${newAddress}`);
    }
  </script>
</body>
</html>

